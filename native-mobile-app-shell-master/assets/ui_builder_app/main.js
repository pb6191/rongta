require.config({paths:{sdk:uiBuilderSDKPath+"/sdk"}}),define(["sdk"],(e=>e.startApp())),define("./pages/404/components/902c9641de4ec9e73427e7192a118d14/bundle.js",[],(()=>({onClick(e){var t;t=void 0,BackendlessUI.Navigator.goToPage("",t)}}))),define("./pages/appt/components/3c13b5f8a5c55d5b6a4c142f86dbe2d6/bundle.js",[],(()=>({onClick(e){var t;t=void 0,BackendlessUI.Navigator.goToPage("profile",t)}}))),define("./pages/appt/components/page/bundle.js",[],(()=>({async onBeforeEnter(e){function t(e,t){if("string"!=typeof t||void 0!==e[t])return e[t];const a=t.split(".");let n=e;for(let e=0;e<a.length;e++){if(!n||void 0===n[a[e]])return;n=n[a[e]]}return n}e.context.pageData.headcontent=String("Manage Appointments ")+String(t(await Backendless.UserService.getCurrentUser(!1),"name")),e.context.pageData.datalist=await Promise.all((await Backendless.Data.of("appt").find(Backendless.DataQueryBuilder.create().setWhereClause(["custemail = '",t(await Backendless.UserService.getCurrentUser(!1),"email"),"'"].join("")).setProperties(["prvemail","services","totalcost","status","time","objectId","address"]).setPageSize(100))).map((async e=>({objectId:t(e,"objectId"),chatprvemail:t(e,"prvemail"),prvemail:String("Appointment Requested from ")+String(t((await Backendless.Data.of("prvsignupdata").find(Backendless.DataQueryBuilder.create().setWhereClause(["email = '",t(e,"prvemail"),"'"].join("")).setProperties("Name").setPageSize(10)))[0],"Name")),services:t(e,"services"),totalcost:String("Total Transaction Value is ")+String(t(e,"totalcost")),fulfil:"accepted"==t(e,"status"),cancel:"accepted"==t(e,"status")||"requested"==t(e,"status"),rejectedpro:"rejected"==t(e,"status"),paymentfailed:"paymentfailed"==t(e,"status"),canceledyou:"canceledcust"==t(e,"status"),canceledpro:"canceledprv"==t(e,"status"),fulfiled:"fulfiled"==t(e,"status"),editappt:"requested"==t(e,"status"),appttime:String("Appointment Time: ")+String(new Date(t(e,"time"))),apptaddress:String("Appointment Address: ")+String(t(e,"address"))}))))}}))),define("./pages/appt/components/e57377121bf38f57000c6684e66e771a/bundle.js",[],(()=>({onClick(e){var t;t=void 0,BackendlessUI.Navigator.goToPage("menu",t)}}))),define("./pages/appt/components/efec0f670c1aa65ff44b754cf7165a16/bundle.js",[],(()=>({onClick(e){var t,a;try{e.context.getComponentDataStoreByUid("a3e69f69306e9eea26174fb541a96b83").chatbuttondis=!0,a=e.context.getComponentDataStoreByUid("a3e69f69306e9eea26174fb541a96b83"),BackendlessUI.Navigator.goToPage("chat",a)}catch(t){console.log(t),e.context.getComponentDataStoreByUid("a3e69f69306e9eea26174fb541a96b83").chatbuttondis=!1}}}))),define("./pages/appt/components/a45a8f58936aa6abc3b69abd66860961/bundle.js",[],(()=>({onClick(e){var t,a;try{e.context.getComponentDataStoreByUid("a3e69f69306e9eea26174fb541a96b83").editapptbuttondis=!0,a=e.context.getComponentDataStoreByUid("a3e69f69306e9eea26174fb541a96b83"),BackendlessUI.Navigator.goToPage("pageprovideredit",a)}catch(t){console.log(t),e.context.getComponentDataStoreByUid("a3e69f69306e9eea26174fb541a96b83").editapptbuttondis=!1}}}))),define("./pages/appt/components/7b8f6b54baa95adc09275abd6769fc85/bundle.js",[],(()=>({onClick(e){var t,a;try{e.context.getComponentDataStoreByUid("a3e69f69306e9eea26174fb541a96b83").fulfilbuttondis=!0,a=e.context.getComponentDataStoreByUid("a3e69f69306e9eea26174fb541a96b83"),BackendlessUI.Navigator.goToPage("ratefulfil",a)}catch(t){console.log(t),e.context.getComponentDataStoreByUid("a3e69f69306e9eea26174fb541a96b83").fulfilbuttondis=!1}}}))),define("./pages/appt/components/f673c01876f4e00182ee8a8c8fde88a7/bundle.js",[],(()=>({async onClick(e){var t,a,n,s,r,o,i,c,d,l,p,u;function g(e,t){if("string"!=typeof t||void 0!==e[t])return e[t];const a=t.split(".");let n=e;for(let e=0;e<a.length;e++){if(!n||void 0===n[a[e]])return;n=n[a[e]]}return n}function f(e){return Array.isArray(e)?e:[e]}try{if(e.context.getComponentDataStoreByUid("a3e69f69306e9eea26174fb541a96b83").cancelbuttondis=!0,c=null,d=null,n=null,i=null,s=null,a=null,t=await Backendless.Data.of("appt").find(Backendless.DataQueryBuilder.create().setWhereClause(["objectId = '",g(e.context.getComponentDataStoreByUid("a3e69f69306e9eea26174fb541a96b83"),"objectId"),"'"].join("")).setProperties(["latest_charge","refund_amount","objectId","address","amount","card","client_secret","intent_id","last","custemail","prvemail","services","status","time","totalcost"]).setPageSize(10)),p=await Backendless.Data.of("srvcity").find(Backendless.DataQueryBuilder.create().setWhereClause(["email = '",g(t[0],"prvemail"),"'"].join("")).setProperties(["stripeaccountid","avgrating","totalratings","cityserviced","email","name","pic","professions","services","objectId"]).setPageSize(100)),"accepted"==g(t[0],"status")){if((new Date).valueOf()<g(t[0],"time")-864e5){if(console.log("before appt start-24hrs"),d=await Backendless.Request.post(`${Backendless.appPath}/services/PaymentService/createRefund`).set("Content-Type","application/json").set((u={"user-token":Backendless.getCurrentUserToken()},u["user-token"]||delete u["user-token"],u)).send({amount:100*g(t[0],"totalcost"),charge:g(t[0],"latest_charge")}),"succeeded"!=g(d,"status"))throw new Error("full refund not returned with succeeded status");if(c=await Backendless.Data.of("appt").save((await Promise.all(t.map((async e=>({latest_charge:g(e,"latest_charge"),refund_amount:100*g(e,"totalcost"),objectId:g(e,"objectId"),address:g(e,"address"),amount:g(e,"amount"),card:g(e,"card"),client_secret:g(e,"client_secret"),intent_id:g(e,"intent_id"),last:g(e,"last"),custemail:g(e,"custemail"),prvemail:g(e,"prvemail"),services:g(e,"services"),status:"canceledcust",time:g(e,"time"),totalcost:g(e,"totalcost")})))))[0]),g(c,"refund_amount")!=100*g(t[0],"totalcost"))throw new Error("refund amount in the returned appt record does not match the sent amount")}else if((new Date).valueOf()<g(t[0],"time")){if(console.log("between appt start and appt start-24 hrs"),i=await Backendless.Request.post(`${Backendless.appPath}/services/PaymentService/createRefund`).set("Content-Type","application/json").set(function(e){return e["user-token"]||delete e["user-token"],e}({"user-token":Backendless.getCurrentUserToken()})).send({amount:50*g(t[0],"totalcost"),charge:g(t[0],"latest_charge")}),"succeeded"!=g(i,"status"))throw new Error("half refund not returned with succeeded status");if(s=await Backendless.Request.post(`${Backendless.appPath}/services/PaymentService/createTransfer`).set("Content-Type","application/json").set(function(e){return e["user-token"]||delete e["user-token"],e}({"user-token":Backendless.getCurrentUserToken()})).send({amount:50*g(t[0],"totalcost"),currency:"cad",srct:g(t[0],"latest_charge"),dest:g(p[0],"stripeaccountid")}),g(s,"source_transaction")!=g(t[0],"latest_charge"))throw new Error("create transfer record did not return with the provided source transaction");if(n=await Backendless.Data.of("appt").save((await Promise.all(t.map((async e=>({latest_charge:g(e,"latest_charge"),refund_amount:50*g(e,"totalcost"),objectId:g(e,"objectId"),address:g(e,"address"),amount:g(e,"amount"),card:g(e,"card"),client_secret:g(e,"client_secret"),intent_id:g(e,"intent_id"),last:g(e,"last"),custemail:g(e,"custemail"),prvemail:g(e,"prvemail"),services:g(e,"services"),status:"canceledcust",time:g(e,"time"),totalcost:g(e,"totalcost")})))))[0]),g(n,"refund_amount")!=50*g(t[0],"totalcost"))throw new Error("refund amount (half) in the returned appt record does not match the sent amount")}}else if("requested"==g(t[0],"status")&&(a=await Backendless.Data.of("appt").save((await Promise.all(t.map((async e=>({latest_charge:g(e,"latest_charge"),refund_amount:0,objectId:g(e,"objectId"),address:g(e,"address"),amount:g(e,"amount"),card:g(e,"card"),client_secret:g(e,"client_secret"),intent_id:g(e,"intent_id"),last:g(e,"last"),custemail:g(e,"custemail"),prvemail:g(e,"prvemail"),services:g(e,"services"),status:"canceledcust",time:g(e,"time"),totalcost:g(e,"totalcost")})))))[0]),0!=g(a,"refund_amount")))throw new Error("refund amount (zero) in the returned appt record does not match the sent amount");e.context.getComponentDataStoreByUid("a3e69f69306e9eea26174fb541a96b83").fulfil=!1,e.context.getComponentDataStoreByUid("a3e69f69306e9eea26174fb541a96b83").cancel=!1,e.context.getComponentDataStoreByUid("a3e69f69306e9eea26174fb541a96b83").rejectedpro=!1,e.context.getComponentDataStoreByUid("a3e69f69306e9eea26174fb541a96b83").canceledyou=!0,e.context.getComponentDataStoreByUid("a3e69f69306e9eea26174fb541a96b83").canceledpro=!1,e.context.getComponentDataStoreByUid("a3e69f69306e9eea26174fb541a96b83").fulfiled=!1,e.context.getComponentDataStoreByUid("a3e69f69306e9eea26174fb541a96b83").editappt=!1,e.context.getComponentDataStoreByUid("a3e69f69306e9eea26174fb541a96b83").paymentfailed=!1,console.log("we read the status of the old apptobjlist since it is never updated"),"accepted"==g(t[0],"status")?(new Date).valueOf()<g(t[0],"time")-864e5?(console.log("before appt start-24hrs"),await Backendless.Messaging.sendEmail("Confirmed appointment canceled",new Backendless.Bodyparts({textmessage:["Hello ",g(await Backendless.UserService.getCurrentUser(!1),"name"),"\n","You have canceled your appointment with ",g(p[0],"name"),"\n","We have issued you a refund of CAD ",g(t[0],"totalcost"),"\n",.1*g(t[0],"totalcost")," CAD has been retained by us as the platform fee.","\n","Regards, Rongta"].join("")}),f(g(await Backendless.UserService.getCurrentUser(!1),"email")),void 0),await Backendless.Messaging.sendEmail("Confirmed appointment canceled",new Backendless.Bodyparts({textmessage:["Hello ",g(p[0],"name"),"\n",g(await Backendless.UserService.getCurrentUser(!1),"name")," has canceled a confirmed appointment with you.","\n","Regards, Rongta"].join("")}),f(g(p[0],"email")),void 0)):(new Date).valueOf()<g(t[0],"time")&&(console.log("between appt start and appt start-24 hrs"),await Backendless.Messaging.sendEmail("Confirmed appointment canceled less than 24 hours before appointment time",new Backendless.Bodyparts({textmessage:["Hello ",g(await Backendless.UserService.getCurrentUser(!1),"name"),"\n","You have canceled your appointment with ",g(p[0],"name"),"\n","We have issued you a refund of CAD ",.5*g(t[0],"totalcost"),"\n",.1*g(t[0],"totalcost")," CAD has been retained by us as the platform fee.","\n","To ensure fairness to our service providers for late cancellation, we have transferred CAD ",.5*g(t[0],"totalcost")," to ",g(p[0],"name"),"\n","Regards, Rongta"].join("")}),f(g(await Backendless.UserService.getCurrentUser(!1),"email")),void 0),await Backendless.Messaging.sendEmail("Confirmed appointment canceled less than 24 hours before appointment time",new Backendless.Bodyparts({textmessage:["Hello ",g(p[0],"name"),"\n",g(await Backendless.UserService.getCurrentUser(!1),"name")," has canceled a confirmed appointment with you less than 24 hours before appointment time. To ensure fairness, we have issued you a 50% payout worth CAD ",.5*g(t[0],"totalcost"),"\n","Regards, Rongta"].join("")}),f(g(p[0],"email")),void 0)):"requested"==g(t[0],"status")&&(await Backendless.Messaging.sendEmail("Appointment request canceled",new Backendless.Bodyparts({textmessage:["Hello ",g(await Backendless.UserService.getCurrentUser(!1),"name"),"\n","You have canceled your appointment with ",g(p[0],"name"),"\n","Regards, Rongta"].join("")}),f(g(await Backendless.UserService.getCurrentUser(!1),"email")),void 0),await Backendless.Messaging.sendEmail("Appointment request canceled",new Backendless.Bodyparts({textmessage:["Hello ",g(p[0],"name"),"\n",g(await Backendless.UserService.getCurrentUser(!1),"name")," has canceled appointment request with you. It is not possible to accept that appointment request now.","\n","Regards, Rongta"].join("")}),f(g(p[0],"email")),void 0)),e.context.getComponentDataStoreByUid("a3e69f69306e9eea26174fb541a96b83").cancelbuttondis=!1}catch(l){console.log(l),e.context.getComponentDataStoreByUid("a3e69f69306e9eea26174fb541a96b83").guierr=g(l,"message"),d&&"succeeded"==g(d,"status")&&(o=await Backendless.Request.get(`${Backendless.appPath}/services/PaymentService/Payment`).set(function(e){return e["user-token"]||delete e["user-token"],e}({"user-token":Backendless.getCurrentUserToken()})).query({intent_id:JSON.stringify(g(d,"payment_intent"))}).send(),r=await Backendless.Request.post(`${Backendless.appPath}/services/PaymentService/processPayment`).set("Content-Type","application/json").set(function(e){return e["user-token"]||delete e["user-token"],e}({"user-token":Backendless.getCurrentUserToken()})).send({amount:g(d,"amount"),currency:"cad",cust:g(o,"customer")}),await Backendless.Request.post(`${Backendless.appPath}/services/PaymentService/updatePayment`).set("Content-Type","application/json").set(function(e){return e["user-token"]||delete e["user-token"],e}({"user-token":Backendless.getCurrentUserToken()})).send({intent_id:g(r,"id"),amount:g(d,"amount"),meth:g(o,"payment_method"),cust:g(o,"customer")}),await Backendless.Request.post(`${Backendless.appPath}/services/PaymentService/confirmPayment`).set("Content-Type","application/json").set(function(e){return e["user-token"]||delete e["user-token"],e}({"user-token":Backendless.getCurrentUserToken()})).send(JSON.stringify(g(r,"id")))),c&&await Backendless.Data.of("appt").save((await Promise.all([c].map((async e=>t[0]))))[0]),i&&"succeeded"==g(i,"status")&&(o=await Backendless.Request.get(`${Backendless.appPath}/services/PaymentService/Payment`).set(function(e){return e["user-token"]||delete e["user-token"],e}({"user-token":Backendless.getCurrentUserToken()})).query({intent_id:JSON.stringify(g(i,"payment_intent"))}).send(),r=await Backendless.Request.post(`${Backendless.appPath}/services/PaymentService/processPayment`).set("Content-Type","application/json").set(function(e){return e["user-token"]||delete e["user-token"],e}({"user-token":Backendless.getCurrentUserToken()})).send({amount:g(i,"amount"),currency:"cad",cust:g(o,"customer")}),await Backendless.Request.post(`${Backendless.appPath}/services/PaymentService/updatePayment`).set("Content-Type","application/json").set(function(e){return e["user-token"]||delete e["user-token"],e}({"user-token":Backendless.getCurrentUserToken()})).send({intent_id:g(r,"id"),amount:g(i,"amount"),meth:g(o,"payment_method"),cust:g(o,"customer")}),await Backendless.Request.post(`${Backendless.appPath}/services/PaymentService/confirmPayment`).set("Content-Type","application/json").set(function(e){return e["user-token"]||delete e["user-token"],e}({"user-token":Backendless.getCurrentUserToken()})).send(JSON.stringify(g(r,"id")))),s&&g(s,"source_transaction")==g(t[0],"latest_charge")&&await Backendless.Request.post(`${Backendless.appPath}/services/PaymentService/reverseTransfer`).set("Content-Type","application/json").set(function(e){return e["user-token"]||delete e["user-token"],e}({"user-token":Backendless.getCurrentUserToken()})).send(JSON.stringify(g(s,"id"))),n&&await Backendless.Data.of("appt").save((await Promise.all([n].map((async e=>t[0]))))[0]),a&&await Backendless.Data.of("appt").save((await Promise.all([a].map((async e=>t[0]))))[0]),e.context.getComponentDataStoreByUid("a3e69f69306e9eea26174fb541a96b83").cancelbuttondis=!1}}}))),define("./pages/changepwd/components/01f9d801877624c4506e2d53c76c5f7d/bundle.js",[],(()=>({onContentAssignment:async e=>String("Edit your password, ")+String(function(e,t){if("string"!=typeof t||void 0!==e[t])return e[t];const a=t.split(".");let n=e;for(let e=0;e<a.length;e++){if(!n||void 0===n[a[e]])return;n=n[a[e]]}return n}(await Backendless.UserService.getCurrentUser(!1),"name"))}))),define("./pages/changepwd/components/5a81c154112f17b2a94674c70ce43e75/bundle.js",[],(()=>({async onClick(e){var t,a,n,s,r,o,i;function c(e,t){if("string"!=typeof t||void 0!==e[t])return e[t];const a=t.split(".");let n=e;for(let e=0;e<a.length;e++){if(!n||void 0===n[a[e]])return;n=n[a[e]]}return n}try{if(e.context.pageData.disbutton=!0,a=null,s=null,n=null,t=await Backendless.Data.of("signupdata").find(Backendless.DataQueryBuilder.create().setWhereClause(["email = '",c(await Backendless.UserService.getCurrentUser(!1),"email"),"'"].join("")).setProperties(["objectId","email","Name","password","phonenum","postalcode","stripecustid"]).setPageSize(10)),s=await Backendless.Data.of("signupdata").save((await Promise.all(t.map((async t=>({postalcode:c(t,"postalcode"),phonenum:c(t,"phonenum"),objectId:c(t,"objectId"),password:c(e.context.pageData,"newpwd"),Name:c(t,"Name"),stripecustid:c(t,"stripecustid"),email:c(t,"email")})))))[0]),c(s,"password")!=c(e.context.pageData,"newpwd"))throw new Error("password in the updated signup table record is not the same as the one provided");if(n=await Backendless.UserService.update(new Backendless.User({objectId:c(await Backendless.UserService.getCurrentUser(!1),"objectId"),password:c(e.context.pageData,"newpwd")})),c(n,"objectId")!=c(await Backendless.UserService.getCurrentUser(!1),"objectId"))throw new Error("objectId in the updated user object is not the same as the one provided");if(await Backendless.UserService.logout(),a=await Backendless.UserService.login(c(t[0],"email"),c(e.context.pageData,"newpwd"),!0),c(a,"email")!=c(t[0],"email"))throw new Error("email in the updated login object is not the same as the one provided");await Backendless.Messaging.sendEmail("Password updated",new Backendless.Bodyparts({textmessage:["Hello ",c(await Backendless.UserService.getCurrentUser(!1),"name"),"\n","You have successfully updated your password.","\n","Regards, Rongta"].join("")}),(i=c(await Backendless.UserService.getCurrentUser(!1),"email"),Array.isArray(i)?i:[i]),void 0),o=void 0,BackendlessUI.Navigator.goToPage("profile",o)}catch(r){console.log(r),e.context.pageData.guierr=c(r,"message"),s&&await Backendless.Data.of("signupdata").save((await Promise.all([s].map((async e=>t[0]))))[0]),n&&await Backendless.UserService.update(new Backendless.User({objectId:c(n,"objectId"),password:c(t[0],"password")})),a&&(await Backendless.UserService.logout(),await Backendless.UserService.login(c(t[0],"email"),c(t[0],"password"),!0)),e.context.pageData.disbutton=!1}}}))),define("./pages/changepwd/components/e17e6123fdfe66e143eef10474597f8c/bundle.js",[],(()=>({onClick(e){window.history.back()}}))),define("./pages/chat/components/page/bundle.js",[],(()=>({async onBeforeEnter(e){var t;function a(e,t){if("string"!=typeof t||void 0!==e[t])return e[t];const a=t.split(".");let n=e;for(let e=0;e<a.length;e++){if(!n||void 0===n[a[e]])return;n=n[a[e]]}return n}e.context.pageData.myID=a(await Backendless.UserService.getCurrentUser(!1),"email"),e.context.pageData.header=String("Chatting with ")+String(a((await Backendless.Data.of("prvsignupdata").find(Backendless.DataQueryBuilder.create().setWhereClause(["email = '",a(e.context.pageData,"chatprvemail"),"'"].join("")).setProperties("Name").setPageSize(10)))[0],"Name")),t=await Backendless.Data.of("chatmessages").find(Backendless.DataQueryBuilder.create().setWhereClause(["prvemail = '",a(e.context.pageData,"chatprvemail"),"' and custemail = '",a(await Backendless.UserService.getCurrentUser(!1),"email"),"'"].join("")).setProperties(["message","sender","time","senderID"]).setSortBy("created desc").setPageSize(100)),e.context.getComponentByUid("51357761288a50546ad3347e282c9959").dynamicListItems=t,function(t){const a=Backendless.Data.of("chatmessages").rt(),n=[async t=>{t.prevMessage=e.context.getComponentByUid("51357761288a50546ad3347e282c9959").dynamicListItems.length?e.context.getComponentByUid("51357761288a50546ad3347e282c9959").dynamicListItems[0]:null,e.context.getComponentByUid("51357761288a50546ad3347e282c9959").dynamicListItems.splice(0,0,t)}];t&&n.unshift(t),a.addCreateListener.apply(a,n)}(["prvemail = '",a(e.context.pageData,"chatprvemail"),"' and custemail = '",a(await Backendless.UserService.getCurrentUser(!1),"email"),"'"].join(""))}}))),define("./pages/chat/components/d9934271206b3e99f3a8024c38eb5be9/bundle.js",[],(()=>({async onClick(e){var t,a,n;function s(e,t){if("string"!=typeof t||void 0!==e[t])return e[t];const a=t.split(".");let n=e;for(let e=0;e<a.length;e++){if(!n||void 0===n[a[e]])return;n=n[a[e]]}return n}if(null!=s(e.context.pageData,"message"))try{e.context.pageData.disbutton=!0,await Backendless.Data.of("chatmessages").save({message:s(e.context.pageData,"message"),sender:s(await Backendless.UserService.getCurrentUser(!1),"name"),time:(new Date).toLocaleTimeString(),senderID:s(await Backendless.UserService.getCurrentUser(!1),"email"),custemail:s(await Backendless.UserService.getCurrentUser(!1),"email"),prvemail:s(e.context.pageData,"chatprvemail")}),a=await Backendless.Data.of("srvcity").find(Backendless.DataQueryBuilder.create().setWhereClause(["email = '",s(e.context.pageData,"chatprvemail"),"'"].join("")).setProperties(["stripeaccountid","avgrating","totalratings","cityserviced","email","name","pic","professions","services","objectId"]).setPageSize(100)),await Backendless.Messaging.sendEmail("Chat message received",new Backendless.Bodyparts({textmessage:["Hello ",s(a[0],"name"),"\n",s(await Backendless.UserService.getCurrentUser(!1),"name")," just sent you this chat message: ",s(e.context.pageData,"message"),"\n","Regards, Rongta"].join("")}),(n=s(a[0],"email"),Array.isArray(n)?n:[n]),void 0),e.context.pageData.message="",e.context.pageData.disbutton=!1}catch(t){console.log(t),e.context.pageData.disbutton=!1}}}))),define("./pages/chat/components/132d4476770769e9b5e3d18996d52624/bundle.js",[],(()=>({onClick(e){window.history.back()}}))),define("./pages/chat/components/0131192cbf3b08b8f3e55e040615806d/bundle.js",[],(()=>({onDisplayAssignment(e){function t(e,t){if("string"!=typeof t||void 0!==e[t])return e[t];const a=t.split(".");let n=e;for(let e=0;e<a.length;e++){if(!n||void 0===n[a[e]])return;n=n[a[e]]}return n}return!(t(e.context.getComponentDataStoreByUid("fef10ec13eb11b96ddb91a3ec3a9ac27"),"senderID")==t(e.context.pageData,"myID")||t(e.context.getComponentDataStoreByUid("fef10ec13eb11b96ddb91a3ec3a9ac27"),"senderID")==t(e.context.getComponentDataStoreByUid("fef10ec13eb11b96ddb91a3ec3a9ac27"),"prevMessage.senderID"))}}))),define("./pages/chat/components/d515fdfb89d9a1089c5ceec3adbbd2ef/bundle.js",[],(()=>({onClassListAssignment(e){function t(e,t){if("string"!=typeof t||void 0!==e[t])return e[t];const a=t.split(".");let n=e;for(let e=0;e<a.length;e++){if(!n||void 0===n[a[e]])return;n=n[a[e]]}return n}return t(e.context.getComponentDataStoreByUid("fef10ec13eb11b96ddb91a3ec3a9ac27"),"senderID")==t(e.context.pageData,"myID")?["msg","sent"]:["msg","rcvd"]}}))),define("./pages/defpayupdate/components/page/bundle.js",[],(()=>({async onBeforeEnter(e){var t;function a(e,t){if("string"!=typeof t||void 0!==e[t])return e[t];const a=t.split(".");let n=e;for(let e=0;e<a.length;e++){if(!n||void 0===n[a[e]])return;n=n[a[e]]}return n}e.context.pageData.headcontent=String("Add or update your default payment method"),t=a((await Backendless.Data.of("defcard").find(Backendless.DataQueryBuilder.create().setWhereClause(["email = '",a(await Backendless.UserService.getCurrentUser(!1),"email"),"'"].join("")).setProperties(["objectId","last","email"]).setPageSize(10)))[0],"last"),e.context.pageData.deflabel=["Keep your card ending ",t," as default, or"].join(""),"xxxx"==t?(e.context.pageData.rbgchk="radio2",e.context.pageData.nondefvis=!1,e.context.pageData.defvis=!1):(e.context.pageData.rbgchk="radio1",e.context.pageData.nondefvis=!0,e.context.pageData.defvis=!0)},async onEnter(e){await async function(){window.paymentElement=null,window.stripeInstance=null;var e=document.createElement("script");e.src="https://js.stripe.com/v3/",document.head.appendChild(e),e.onload=function(){console.log("Stripe script loaded successfully!");const e=Stripe("pk_live_51Rw4P6AwQAw6rEIQP8KPUFIQdjDgyEcFRcw096HLYxJcMlIdPMGyufwmemOmiNerVELKmrapYh5fH4kb1C71qlQu001VjPOpXp");window.stripeInstance=e;const t=e.elements({appearance:{theme:"flat"}}),a=document.evaluate("//form/div",document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(a){const e={disableLink:!0,hidePostalCode:!0};window.paymentElement=t.create("card",e),window.paymentElement.mount(a),console.log("Payment element mounted successfully.")}else console.error("Failed to locate the form element using XPath.")}}()}}))),define("./pages/defpayupdate/components/62bed3fdedbf96d3c00816f3f06c740e/bundle.js",[],(()=>({onClick(e){window.history.back()}}))),define("./pages/defpayupdate/components/9398bedc5bafe978abe3c6943db89d39/bundle.js",[],(()=>({async onClick(e){var t,a,n,s,r,o,i,c,d,l,p;function u(e,t){if("string"!=typeof t||void 0!==e[t])return e[t];const a=t.split(".");let n=e;for(let e=0;e<a.length;e++){if(!n||void 0===n[a[e]])return;n=n[a[e]]}return n}try{if(e.context.pageData.disbutton=!0,r=null,o=null,a=null,s=u((await Backendless.Data.of("signupdata").find(Backendless.DataQueryBuilder.create().setWhereClause(["email = '",u(await Backendless.UserService.getCurrentUser(!1),"email"),"'"].join("")).setProperties("stripecustid").setPageSize(100)))[0],"stripecustid"),t=await Backendless.Data.of("defcard").find(Backendless.DataQueryBuilder.create().setWhereClause(["email = '",u(await Backendless.UserService.getCurrentUser(!1),"email"),"'"].join("")).setProperties(["objectId","last","email","card"]).setPageSize(10)),"radio1"!=u(e.context.pageData,"rbgchk")){if(c=await async function(){return new Promise(((e,t)=>{if(window.stripeInstance&&window.paymentElement){const a=window.stripeInstance,n=window.paymentElement;a.createToken(n).then((function(a){a.error?(console.error("Error creating token:",a.error.message),t(a.error)):a.token?(console.log("Token created successfully:",a.token),e(a.token)):(console.warn("Unexpected result from createToken:",a),t(new Error("Unexpected result from createToken")))}))}else console.error("Stripe or paymentElement is not initialized."),t(new Error("Stripe or paymentElement is not initialized."))}))}(),r=await Backendless.Request.post(`${Backendless.appPath}/services/PaymentService/createCard`).set("Content-Type","application/json").set((p={"user-token":Backendless.getCurrentUserToken()},p["user-token"]||delete p["user-token"],p)).send({cust:s,src:u(c,"id")}),u(r,"customer")!=s)throw new Error("create card object did not return the customer id provided");if(n=await Backendless.Request.get(`${Backendless.appPath}/services/PaymentService/Customer`).set(function(e){return e["user-token"]||delete e["user-token"],e}({"user-token":Backendless.getCurrentUserToken()})).query({cust_id:JSON.stringify(s)}).send(),o=await Backendless.Request.post(`${Backendless.appPath}/services/PaymentService/updateCust`).set("Content-Type","application/json").set(function(e){return e["user-token"]||delete e["user-token"],e}({"user-token":Backendless.getCurrentUserToken()})).send({cust:s,defsrc:u(r,"id")}),u(o,"default_source")!=u(r,"id"))throw new Error("default source of updated customer object does not match the provided card id");if(a=await Backendless.Data.of("defcard").save((await Promise.all(t.map((async e=>({objectId:u(e,"objectId"),last:u(r,"last4"),email:u(e,"email"),card:u(r,"id")})))))[0]),u(a,"card")!=u(r,"id"))throw new Error("card updated in def card table does not match the provided card id");await Backendless.Messaging.sendEmail("Payment method edited",new Backendless.Bodyparts({textmessage:["Hello ",u(await Backendless.UserService.getCurrentUser(!1),"name"),"\n","You have successfully added/changed your default payment card.","\n","Regards, Rongta"].join("")}),(l=u(await Backendless.UserService.getCurrentUser(!1),"email"),Array.isArray(l)?l:[l]),void 0)}d=void 0,BackendlessUI.Navigator.goToPage("profile",d)}catch(i){console.log(i),e.context.pageData.guierr=u(i,"message"),r&&u(r,"customer")==s&&await Backendless.Request.delete(`${Backendless.appPath}/services/PaymentService/Card`).set("Content-Type","application/json").set(function(e){return e["user-token"]||delete e["user-token"],e}({"user-token":Backendless.getCurrentUserToken()})).send({cust:s,card:u(r,"id")}),o&&u(o,"default_source")==u(r,"id")&&await Backendless.Request.post(`${Backendless.appPath}/services/PaymentService/updateCust`).set("Content-Type","application/json").set(function(e){return e["user-token"]||delete e["user-token"],e}({"user-token":Backendless.getCurrentUserToken()})).send({cust:s,defsrc:u(n,"default_source")}),a&&await Backendless.Data.of("defcard").save((await Promise.all([a].map((async e=>t[0]))))[0]),e.context.pageData.disbutton=!1}}}))),define("./pages/defpayupdate/components/52ab1cf752a82cc70da40b08bc961698/bundle.js",[],(()=>({onChange(e){e.context.pageData.cardch=!1,"radio1"==function(e,t){if("string"!=typeof t||void 0!==e[t])return e[t];const a=t.split(".");let n=e;for(let e=0;e<a.length;e++){if(!n||void 0===n[a[e]])return;n=n[a[e]]}return n}(e.context.pageData,"rbgchk")?e.context.pageData.dislateruse=!0:e.context.pageData.dislateruse=!1}}))),define("./pages/delreq/components/0d635a3d7c3962977c03ab11c0ff99e2/bundle.js",[],(()=>({onContentAssignment:async e=>String("Request account deletion, ")+String(function(e,t){if("string"!=typeof t||void 0!==e[t])return e[t];const a=t.split(".");let n=e;for(let e=0;e<a.length;e++){if(!n||void 0===n[a[e]])return;n=n[a[e]]}return n}(await Backendless.UserService.getCurrentUser(!1),"name"))}))),define("./pages/delreq/components/233f0e793e1a410ea2c4052aeb1c0968/bundle.js",[],(()=>({onClick(e){var t;t=void 0,BackendlessUI.Navigator.goToPage("menu",t)}}))),define("./pages/delreq/components/6a4bd36b61c8686d39ab25f66058079e/bundle.js",[],(()=>({onClick(e){var t;t=void 0,BackendlessUI.Navigator.goToPage("appt",t)}}))),define("./pages/delreq/components/b1b4c1c7a3d9b63a10ff08984d9859be/bundle.js",[],(()=>({async onClick(e){function t(e,t){if("string"!=typeof t||void 0!==e[t])return e[t];const a=t.split(".");let n=e;for(let e=0;e<a.length;e++){if(!n||void 0===n[a[e]])return;n=n[a[e]]}return n}var a,n;await Backendless.Messaging.sendEmail("New submission from Account Deletion Request",new Backendless.Bodyparts({textmessage:["Name: ",t(await Backendless.UserService.getCurrentUser(!1),"name"),"\n","Email: ",t(await Backendless.UserService.getCurrentUser(!1),"email"),"\n","Reason: ",t(e.context.pageData,"delreason")].join("")}),(a="pb6191@gmail.com",Array.isArray(a)?a:[a]),void 0),await Backendless.UserService.logout(),n=void 0,BackendlessUI.Navigator.goToPage("landing",n)}}))),define("./pages/faqs/components/b423692f2c8fc21f770680060e64f408/bundle.js",[],(()=>({onClick(e){window.history.back()}}))),define("./pages/fgtpwd/components/5a81c154112f17b2a94674c70ce43e75/bundle.js",[],(()=>({async onClick(e){var t,a,n,s;function r(e,t){if("string"!=typeof t||void 0!==e[t])return e[t];const a=t.split(".");let n=e;for(let e=0;e<a.length;e++){if(!n||void 0===n[a[e]])return;n=n[a[e]]}return n}try{if(e.context.pageData.disbutton=!0,t=null,n=await Backendless.Data.of("signupdata").find(Backendless.DataQueryBuilder.create().setWhereClause(["email = '",r(e.context.pageData,"email"),"'"].join("")).setProperties(["objectId","email","Name","password","phonenum","postalcode","stripecustid"]).setPageSize(10)),r(e.context.pageData,"enteredotp")==r(e.context.pageData,"generatedotp")){if(t=await Backendless.UserService.login(r(e.context.pageData,"email"),r(n[0],"password"),!0),r(t,"email")!=r(e.context.pageData,"email"))throw new Error("returned login object user does not have the same email as the one enetered");s=void 0,BackendlessUI.Navigator.goToPage("changepwd",s)}e.context.pageData.disbutton=!1}catch(a){console.log(a),e.context.pageData.guierr=r(a,"message"),t&&await Backendless.UserService.logout(),e.context.pageData.disbutton=!1}}}))),define("./pages/fgtpwd/components/e17e6123fdfe66e143eef10474597f8c/bundle.js",[],(()=>({onClick(e){window.history.back()}}))),define("./pages/fgtpwd/components/ef8be7480dfde90e7719fc9c58af38ab/bundle.js",[],(()=>({async onClick(e){var t,a;function n(e,t){if("string"!=typeof t||void 0!==e[t])return e[t];const a=t.split(".");let n=e;for(let e=0;e<a.length;e++){if(!n||void 0===n[a[e]])return;n=n[a[e]]}return n}try{e.context.pageData.disbuttongenotp=!0,e.context.pageData.generatedotp=function(){const e=()=>Math.random().toString(16).slice(-4),t=()=>`${e()}${e()}`;return{short:()=>t(),long:()=>`${t()}-${e()}-${e()}-${e()}-${t()}${e()}`}}().short(),await Backendless.Messaging.sendEmail("Your one-time passcode for login",new Backendless.Bodyparts({textmessage:["Hello ","\n","Here is your one-time passcode for login: ",n(e.context.pageData,"generatedotp"),"\n","Regards, Rongta"].join("")}),(a=n(e.context.pageData,"email"),Array.isArray(a)?a:[a]),void 0),e.context.pageData.disbuttongenotp=!1}catch(t){console.log(t),e.context.pageData.disbuttongenotp=!1}}}))),define("./pages/landing/components/page/bundle.js",[],(()=>({async onBeforeEnter(e){console.log(await Backendless.UserService.getCurrentUser(!1)),null!=await Backendless.UserService.getCurrentUser(!1)?(e.context.pageData.beginvis=!1,e.context.pageData.beginvis2=!1,e.context.pageData.backvis=!0,e.context.pageData.spinone=!0):(e.context.pageData.beginvis=!0,e.context.pageData.beginvis2=!0,e.context.pageData.backvis=!1,e.context.pageData.spinone=!1)},async onEnter(e){var t;null!=await Backendless.UserService.getCurrentUser(!1)&&(await new Promise((e=>setTimeout(e,1e3))),t=void 0,BackendlessUI.Navigator.goToPage("menu",t))}}))),define("./pages/landing/components/80787df7c532d21777ce08bb6ab66c6f/bundle.js",[],(()=>({onClick(e){var t;t=void 0,BackendlessUI.Navigator.goToPage("signup",t)}}))),define("./pages/landing/components/cb9aa574c8d177d7c97ac2e14f66e0d6/bundle.js",[],(()=>({onClick(e){var t;t=void 0,BackendlessUI.Navigator.goToPage("menu",t)}}))),define("./pages/list/components/3c13b5f8a5c55d5b6a4c142f86dbe2d6/bundle.js",[],(()=>({onClick(e){var t;t=void 0,BackendlessUI.Navigator.goToPage("profile",t)}}))),define("./pages/list/components/page/bundle.js",[],(()=>({async onBeforeEnter(e){var t;function a(e,t){if("string"!=typeof t||void 0!==e[t])return e[t];const a=t.split(".");let n=e;for(let e=0;e<a.length;e++){if(!n||void 0===n[a[e]])return;n=n[a[e]]}return n}null!=await Backendless.UserService.getCurrentUser(!1)?(e.context.pageData.protextvis=!0,e.context.pageData.pinv=await async function(e,t){try{let a=null;e=JSON.parse(e);let n=t.substring(0,3).toUpperCase();return a=e[n][0],a?console.log(`The city for ZIP code ${n} is: ${a}`):console.log(`No city found for ZIP code ${n}`),a.toString()}catch(e){console.error("Error:",e)}}(await Backendless.Request.get(function(e){if(!e)throw new Error("Url must be specified.");return e.startsWith("http://")||e.startsWith("https://")?e:"https://"+e}(function(e){if(e.startsWith("http://")||e.startsWith("https://"))return e;let t;try{t=decodeURI(e)}finally{return(t||e).split("/").map(encodeURIComponent).join("/")}}("https://raw.githubusercontent.com/pb6191/zipcity/refs/heads/main/canadianZipcity.json"))).setEncoding("utf8").then((e=>function(e,t){return e?t&&"object"==typeof t?JSON.stringify(t):t:"undefined"!=typeof Buffer?t instanceof Buffer?t.toJSON().data:Buffer.from(JSON.stringify(t)).toJSON().data:t}("utf8",e))),a(await Backendless.UserService.getCurrentUser(!1),"postalcode"))):(e.context.pageData.protextvis=!1,e.context.pageData.pinv="Toronto"),"Barber / Hairdresser"==a(e.context.pageData,"profession")?e.context.pageData.pghead="Barbers / Hairdressers in Your Area":"Massage Therapy"==a(e.context.pageData,"profession")?e.context.pageData.pghead="Massage Therapists in Your Area":"Spa Therapy"==a(e.context.pageData,"profession")&&(e.context.pageData.pghead="Spa Therapists in Your Area"),e.context.pageData.datalist=await Promise.all((await Backendless.Data.of("srvcity").find(Backendless.DataQueryBuilder.create().setWhereClause(["cityserviced = '",a(e.context.pageData,"pinv"),"' AND professions LIKE '%",a(e.context.pageData,"profession"),"%'"].join("")).setProperties(["email","pic","name","services","avgrating","totalratings"]).setPageSize(100))).map((async e=>(t=0==a(e,"totalratings")?"Rating: No ratings yet!":["Rating: ",a(e,"avgrating")," [",a(e,"totalratings")," review(s)]"].join(""),{name:a(e,"name"),email:a(e,"email"),picurl:a(e,"pic"),desc:["Services Provided:","\n",a(e,"services")].join(""),rating:t}))))}}))),define("./pages/list/components/62bed3fdedbf96d3c00816f3f06c740e/bundle.js",[],(()=>({onClick(e){window.history.back()}}))),define("./pages/list/components/e286d67777070da9ba72be0eb35fa8fe/bundle.js",[],(()=>({async onChange(e){var t;function a(e,t){if("string"!=typeof t||void 0!==e[t])return e[t];const a=t.split(".");let n=e;for(let e=0;e<a.length;e++){if(!n||void 0===n[a[e]])return;n=n[a[e]]}return n}e.context.pageData.datalist=await Promise.all((await Backendless.Data.of("srvcity").find(Backendless.DataQueryBuilder.create().setWhereClause(["cityserviced = '",a(e.context.pageData,"pinv"),"' AND professions LIKE '%",a(e.context.pageData,"profession"),"%'"].join("")).setProperties(["email","pic","name","services","avgrating","totalratings"]).setPageSize(100))).map((async e=>(t=0==a(e,"totalratings")?"Rating: No ratings yet!":["Rating: ",a(e,"avgrating")," [",a(e,"totalratings")," review(s)]"].join(""),{name:a(e,"name"),email:a(e,"email"),picurl:a(e,"pic"),desc:["Services Provided:","\n",a(e,"services")].join(""),rating:t}))))}}))),define("./pages/list/components/9de5d121346d24d3612c72cd204d5136/bundle.js",[],(()=>({async onClick(e){var t,a,n,s;function r(e,t){if("string"!=typeof t||void 0!==e[t])return e[t];const a=t.split(".");let n=e;for(let e=0;e<a.length;e++){if(!n||void 0===n[a[e]])return;n=n[a[e]]}return n}try{e.context.getComponentDataStoreByUid("1ecdcdbb86538517537324612dc13ba1").bookbutt=!0,null!=await Backendless.UserService.getCurrentUser(!1)?(a=await Backendless.Request.post(`${Backendless.appPath}/services/PaymentService/processPayment`).set("Content-Type","application/json").set((s={"user-token":Backendless.getCurrentUserToken()},s["user-token"]||delete s["user-token"],s)).send({amount:50,currency:"cad",cust:r((await Backendless.Data.of("signupdata").find(Backendless.DataQueryBuilder.create().setWhereClause(["email = '",r(await Backendless.UserService.getCurrentUser(!1),"email"),"'"].join("")).setProperties("stripecustid").setPageSize(100)))[0],"stripecustid")}),e.context.getComponentDataStoreByUid("1ecdcdbb86538517537324612dc13ba1").client_secret=r(a,"client_secret"),e.context.getComponentDataStoreByUid("1ecdcdbb86538517537324612dc13ba1").intent_id=r(a,"id"),n=e.context.getComponentDataStoreByUid("1ecdcdbb86538517537324612dc13ba1"),BackendlessUI.Navigator.goToPage("pageprovider",n)):function(e,t){BackendlessUI.Navigator.goToPage("signup",t)}(0,void 0)}catch(t){console.log(t),e.context.getComponentDataStoreByUid("1ecdcdbb86538517537324612dc13ba1").bookbutt=!1}}}))),define("./pages/menu/components/3c13b5f8a5c55d5b6a4c142f86dbe2d6/bundle.js",[],(()=>({onClick(e){var t;t=void 0,BackendlessUI.Navigator.goToPage("profile",t)}}))),define("./pages/menu/components/2c22eecd1fe1e16c6eea66c32c3d5bd5/bundle.js",[],(()=>({onClick(e){var t;t={profession:"Spa Therapy"},BackendlessUI.Navigator.goToPage("list",t)}}))),define("./pages/menu/components/d922d4a8883ba9d30be8aba7630cc044/bundle.js",[],(()=>({onClick(e){var t;t=void 0,BackendlessUI.Navigator.goToPage("appt",t)}}))),define("./pages/menu/components/page/bundle.js",[],(()=>({async onBeforeEnter(e){null!=await Backendless.UserService.getCurrentUser(!1)?(e.context.pageData.apptextvis=!0,e.context.pageData.protextvis=!0):(e.context.pageData.apptextvis=!1,e.context.pageData.protextvis=!1)}}))),define("./pages/pageprovider/components/3c13b5f8a5c55d5b6a4c142f86dbe2d6/bundle.js",[],(()=>({onClick(e){var t;t=void 0,BackendlessUI.Navigator.goToPage("profile",t)}}))),define("./pages/pageprovider/components/page/bundle.js",[],(()=>({async onBeforeEnter(e){var t;function a(e,t){if("string"!=typeof t||void 0!==e[t])return e[t];const a=t.split(".");let n=e;for(let e=0;e<a.length;e++){if(!n||void 0===n[a[e]])return;n=n[a[e]]}return n}e.context.pageData.showtotal=["Your total (incl. 10% platform fee) is: ",0," (You will only be charged if/when service provider accepts the appointment)"].join(""),e.context.pageData.datalist=await Backendless.Data.of("serviceproviders").find(Backendless.DataQueryBuilder.create().setWhereClause(["email = '",a(e.context.pageData,"email"),"'"].join("")).setProperties(["services","price"]).setSortBy("created").setPageSize(100)),e.context.pageData.headcontent=["Book Appointment - Services Provided by ",a((await Backendless.Data.of("prvsignupdata").find(Backendless.DataQueryBuilder.create().setWhereClause(["email = '",a(e.context.pageData,"email"),"'"].join("")).setProperties("Name").setPageSize(100)))[0],"Name")," in ",a((await Backendless.Data.of("srvcity").find(Backendless.DataQueryBuilder.create().setWhereClause(["email = '",a(e.context.pageData,"email"),"'"].join("")).setProperties("cityserviced").setPageSize(100)))[0],"cityserviced")].join(""),e.context.pageData.picurl=a((await Backendless.Data.of("srvcity").find(Backendless.DataQueryBuilder.create().setWhereClause(["email = '",a(e.context.pageData,"email"),"'"].join("")).setProperties("pic").setPageSize(100)))[0],"pic"),e.context.pageData.rating=a((await Promise.all((await Backendless.Data.of("srvcity").find(Backendless.DataQueryBuilder.create().setWhereClause(["email = '",a(e.context.pageData,"email"),"'"].join("")).setProperties(["avgrating","totalratings"]).setPageSize(100))).map((async e=>({rating:0==a(e,"totalratings")?"Rating: No ratings yet!":["Rating: ",a(e,"avgrating")," [",a(e,"totalratings")," review(s)]"].join("")})))))[0],"rating"),t=a((await Backendless.Data.of("defcard").find(Backendless.DataQueryBuilder.create().setWhereClause(["email = '",a(await Backendless.UserService.getCurrentUser(!1),"email"),"'"].join("")).setProperties(["objectId","last","email"]).setPageSize(10)))[0],"last"),e.context.pageData.deflabel=["Choose your card ending ",t," (your default payment method), or"].join(""),"xxxx"==t?(e.context.pageData.rbgchk="radio2",e.context.pageData.nondefvis=!1,e.context.pageData.defvis=!1,e.context.pageData.dislateruse=!1):(e.context.pageData.rbgchk="radio1",e.context.pageData.nondefvis=!0,e.context.pageData.defvis=!0,e.context.pageData.dislateruse=!0)},async onEnter(e){await async function(e){window.paymentElement=null,window.stripeInstance=null,window.csec=e;var t=document.createElement("script");t.src="https://js.stripe.com/v3/",document.head.appendChild(t),t.onload=function(){if(console.log("Stripe script loaded successfully!"),!window.csec)return void console.error("Client secret (csec) is not defined.");const e=Stripe("pk_live_51Rw4P6AwQAw6rEIQP8KPUFIQdjDgyEcFRcw096HLYxJcMlIdPMGyufwmemOmiNerVELKmrapYh5fH4kb1C71qlQu001VjPOpXp");window.stripeInstance=e;const t={clientSecret:window.csec,appearance:{theme:"flat"}},a=e.elements(t),n=document.evaluate("//form/div",document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(n){const e={disableLink:!0,hidePostalCode:!0};window.paymentElement=a.create("card",e),window.paymentElement.mount(n),console.log("Payment element mounted successfully.")}else console.error("Failed to locate the form element using XPath.")}}(function(e,t){if("string"!=typeof t||void 0!==e[t])return e[t];const a=t.split(".");let n=e;for(let e=0;e<a.length;e++){if(!n||void 0===n[a[e]])return;n=n[a[e]]}return n}(e.context.pageData,"client_secret"))}}))),define("./pages/pageprovider/components/62bed3fdedbf96d3c00816f3f06c740e/bundle.js",[],(()=>({onClick(e){window.history.back()}}))),define("./pages/pageprovider/components/9398bedc5bafe978abe3c6943db89d39/bundle.js",[],(()=>({async onClick(e){var t,a,n,s,r,o,i,c,d,l,p,u,g,f,m,v,k,y,w,B;function h(e,t){if("string"!=typeof t||void 0!==e[t])return e[t];const a=t.split(".");let n=e;for(let e=0;e<a.length;e++){if(!n||void 0===n[a[e]])return;n=n[a[e]]}return n}function b(e){return Array.isArray(e)?e:[e]}try{e.context.pageData.disbuttonforappt=!0,d=null,l=null,o=null,s=null,t=null,c=h((await Backendless.Data.of("signupdata").find(Backendless.DataQueryBuilder.create().setWhereClause(["email = '",h(await Backendless.UserService.getCurrentUser(!1),"email"),"'"].join("")).setProperties("stripecustid").setPageSize(100)))[0],"stripecustid"),r=await Backendless.Data.of("defcard").find(Backendless.DataQueryBuilder.create().setWhereClause(["email = '",h(await Backendless.UserService.getCurrentUser(!1),"email"),"'"].join("")).setProperties(["objectId","last","email","card"]).setPageSize(10)),m="",n=0;var D=e.context.getComponentByUid("c46b23da0c13145db7313a01464433d6").dynamicListItems;for(var C in D)1==h(y=D[C],"servch")&&(console.log(y),n+=h(y,"price"),m=[m,h(y,"services")," for ",h(y,"price"),". "].join(""));if("radio1"==h(e.context.pageData,"rbgchk"))f=h(k=r[0],"card"),g=h(k,"last");else{if(v=await async function(){return new Promise(((e,t)=>{if(window.stripeInstance&&window.paymentElement){const a=window.stripeInstance,n=window.paymentElement;a.createToken(n).then((function(a){a.error?(console.error("Error creating token:",a.error.message),t(a.error)):a.token?(console.log("Token created successfully:",a.token),e(a.token)):(console.warn("Unexpected result from createToken:",a),t(new Error("Unexpected result from createToken")))}))}else console.error("Stripe or paymentElement is not initialized."),t(new Error("Stripe or paymentElement is not initialized."))}))}(),d=await Backendless.Request.post(`${Backendless.appPath}/services/PaymentService/createCard`).set("Content-Type","application/json").set((B={"user-token":Backendless.getCurrentUserToken()},B["user-token"]||delete B["user-token"],B)).send({cust:c,src:h(v,"id")}),h(d,"customer")!=c)throw new Error("create card object did not return the customer id provided");if(f=h(d,"id"),g=h(d,"last4"),1==h(e.context.pageData,"cardch")){if(i=await Backendless.Request.get(`${Backendless.appPath}/services/PaymentService/Customer`).set(function(e){return e["user-token"]||delete e["user-token"],e}({"user-token":Backendless.getCurrentUserToken()})).query({cust_id:JSON.stringify(c)}).send(),l=await Backendless.Request.post(`${Backendless.appPath}/services/PaymentService/updateCust`).set("Content-Type","application/json").set(function(e){return e["user-token"]||delete e["user-token"],e}({"user-token":Backendless.getCurrentUserToken()})).send({cust:c,defsrc:h(d,"id")}),h(l,"default_source")!=h(d,"id"))throw new Error("default source of updated customer object does not match the provided card id");if(o=await Backendless.Data.of("defcard").save((await Promise.all(r.map((async e=>({objectId:h(e,"objectId"),last:h(d,"last4"),email:h(e,"email"),card:h(d,"id")})))))[0]),h(o,"card")!=h(d,"id"))throw new Error("card updated in def card table does not match the provided card id")}}if(0==n)throw new Error("Please select atleast one service to book the appointment");if(a=await Backendless.Request.get(`${Backendless.appPath}/services/PaymentService/Payment`).set(function(e){return e["user-token"]||delete e["user-token"],e}({"user-token":Backendless.getCurrentUserToken()})).query({intent_id:JSON.stringify(h(e.context.pageData,"intent_id"))}).send(),s=await Backendless.Request.post(`${Backendless.appPath}/services/PaymentService/updatePayment`).set("Content-Type","application/json").set(function(e){return e["user-token"]||delete e["user-token"],e}({"user-token":Backendless.getCurrentUserToken()})).send({intent_id:h(e.context.pageData,"intent_id"),amount:110*n,meth:f,cust:c}),h(s,"amount")!=110*n)throw new Error("amount in updated payment intent does not match the provided amount");if(t=await Backendless.Data.of("appt").save({intent_id:h(e.context.pageData,"intent_id"),address:h(e.context.pageData,"addval"),custemail:h(await Backendless.UserService.getCurrentUser(!1),"email"),prvemail:h(e.context.pageData,"email"),services:m,status:"requested",time:h(e.context.pageData,"datetimedata"),totalcost:n,amount:110*n,client_secret:h(e.context.pageData,"client_secret"),card:f,last:g}),h(t,"amount")!=110*n)throw new Error("amount in created appt record does not match the provided amount");u=await Backendless.Data.of("srvcity").find(Backendless.DataQueryBuilder.create().setWhereClause(["email = '",h(e.context.pageData,"email"),"'"].join("")).setProperties(["stripeaccountid","avgrating","totalratings","cityserviced","email","name","pic","professions","services","objectId"]).setPageSize(100)),1==h(e.context.pageData,"cardch")&&await Backendless.Messaging.sendEmail("Payment method edited",new Backendless.Bodyparts({textmessage:["Hello ",h(await Backendless.UserService.getCurrentUser(!1),"name"),"\n","You have successfully added/changed your default payment card.","\n","Regards, Rongta"].join("")}),b(h(await Backendless.UserService.getCurrentUser(!1),"email")),void 0),await Backendless.Messaging.sendEmail("New appointment request",new Backendless.Bodyparts({textmessage:["Hello ",h(await Backendless.UserService.getCurrentUser(!1),"name"),"\n","You have successfully requested an appointment from ",h(u[0],"name"),"\n","Regards, Rongta"].join("")}),b(h(await Backendless.UserService.getCurrentUser(!1),"email")),void 0),await Backendless.Messaging.sendEmail("New appointment request",new Backendless.Bodyparts({textmessage:["Hello ",h(u[0],"name"),"\n",h(await Backendless.UserService.getCurrentUser(!1),"name")," has requested an appointment with you.","\n","Regards, Rongta"].join("")}),b(h(u[0],"email")),void 0),w=void 0,BackendlessUI.Navigator.goToPage("appt",w)}catch(p){console.log(p),e.context.pageData.guierr=h(p,"message"),d&&h(d,"customer")==c&&await Backendless.Request.delete(`${Backendless.appPath}/services/PaymentService/Card`).set("Content-Type","application/json").set(function(e){return e["user-token"]||delete e["user-token"],e}({"user-token":Backendless.getCurrentUserToken()})).send({cust:c,card:h(d,"id")}),l&&h(l,"default_source")==h(d,"id")&&await Backendless.Request.post(`${Backendless.appPath}/services/PaymentService/updateCust`).set("Content-Type","application/json").set(function(e){return e["user-token"]||delete e["user-token"],e}({"user-token":Backendless.getCurrentUserToken()})).send({cust:c,defsrc:h(i,"default_source")}),o&&await Backendless.Data.of("defcard").save((await Promise.all([o].map((async e=>r[0]))))[0]),s&&h(s,"amount")==110*n&&await Backendless.Request.post(`${Backendless.appPath}/services/PaymentService/updatePayment`).set("Content-Type","application/json").set(function(e){return e["user-token"]||delete e["user-token"],e}({"user-token":Backendless.getCurrentUserToken()})).send({intent_id:h(e.context.pageData,"intent_id"),amount:h(a,"amount"),meth:h(a,"payment_method"),cust:h(a,"customer")}),t&&await Backendless.Data.of("appt").remove(h(t,"objectId")),e.context.pageData.disbuttonforappt=!1}}}))),define("./pages/pageprovider/components/57a97a6a4c291465fecbeed6a436d02c/bundle.js",[],(()=>({onChange(e){var t,a,n;function s(e,t){if("string"!=typeof t||void 0!==e[t])return e[t];const a=t.split(".");let n=e;for(let e=0;e<a.length;e++){if(!n||void 0===n[a[e]])return;n=n[a[e]]}return n}try{e.context.getComponentDataStoreByUid("a3e69f69306e9eea26174fb541a96b83").discheck=!0,a=0;var r=e.context.getComponentByUid("c46b23da0c13145db7313a01464433d6").dynamicListItems;for(var o in r)1==s(n=r[o],"servch")&&(a+=s(n,"price"));e.context.pageData.showtotal=["Your total (incl. 10% platform fee) is: ",1.1*a," (You will only be charged if/when service provider accepts the appointment)"].join(""),e.context.pageData.visbutton=0!=a,e.context.getComponentDataStoreByUid("a3e69f69306e9eea26174fb541a96b83").discheck=!1}catch(t){console.log(t),e.context.getComponentDataStoreByUid("a3e69f69306e9eea26174fb541a96b83").discheck=!1}}}))),define("./pages/pageprovider/components/52ab1cf752a82cc70da40b08bc961698/bundle.js",[],(()=>({onChange(e){e.context.pageData.cardch=!1,"radio1"==function(e,t){if("string"!=typeof t||void 0!==e[t])return e[t];const a=t.split(".");let n=e;for(let e=0;e<a.length;e++){if(!n||void 0===n[a[e]])return;n=n[a[e]]}return n}(e.context.pageData,"rbgchk")?e.context.pageData.dislateruse=!0:e.context.pageData.dislateruse=!1}}))),define("./pages/pageprovideredit/components/3c13b5f8a5c55d5b6a4c142f86dbe2d6/bundle.js",[],(()=>({onClick(e){var t;t=void 0,BackendlessUI.Navigator.goToPage("profile",t)}}))),define("./pages/pageprovideredit/components/page/bundle.js",[],(()=>({async onBeforeEnter(e){var t,a,n,s,r,o,i;function c(e,t){if("string"!=typeof t||void 0!==e[t])return e[t];const a=t.split(".");let n=e;for(let e=0;e<a.length;e++){if(!n||void 0===n[a[e]])return;n=n[a[e]]}return n}function d(e,t){var a=t,n=e.length-1+1;return e.slice(a,n)}console.log(e.context.pageData),e.context.pageData.visbutton=!0,e.context.pageData.showtotal=["Your total (incl. 10% platform fee) is: ",1.1*Number(d(c(e.context.pageData,"totalcost"),27))," (You will only be charged if/when service provider accepts the appointment)"].join(""),e.context.pageData.datalist=await Backendless.Data.of("serviceproviders").find(Backendless.DataQueryBuilder.create().setWhereClause(["email = '",c(e.context.pageData,"chatprvemail"),"'"].join("")).setProperties(["services","price"]).setSortBy("created").setPageSize(100)),e.context.pageData.headcontent=["Edit Appointment with ",c((await Backendless.Data.of("prvsignupdata").find(Backendless.DataQueryBuilder.create().setWhereClause(["email = '",c(e.context.pageData,"chatprvemail"),"'"].join("")).setProperties("Name").setPageSize(100)))[0],"Name")," in ",c((await Backendless.Data.of("srvcity").find(Backendless.DataQueryBuilder.create().setWhereClause(["email = '",c(e.context.pageData,"chatprvemail"),"'"].join("")).setProperties("cityserviced").setPageSize(100)))[0],"cityserviced")].join(""),e.context.pageData.picurl=c((await Backendless.Data.of("srvcity").find(Backendless.DataQueryBuilder.create().setWhereClause(["email = '",c(e.context.pageData,"chatprvemail"),"'"].join("")).setProperties("pic").setPageSize(100)))[0],"pic"),e.context.pageData.rating=c((await Promise.all((await Backendless.Data.of("srvcity").find(Backendless.DataQueryBuilder.create().setWhereClause(["email = '",c(e.context.pageData,"chatprvemail"),"'"].join("")).setProperties(["avgrating","totalratings"]).setPageSize(100))).map((async e=>({rating:0==c(e,"totalratings")?"Rating: No ratings yet!":["Rating: ",c(e,"avgrating")," [",c(e,"totalratings")," review(s)]"].join("")})))))[0],"rating");var l=e.context.getComponentByUid("c46b23da0c13145db7313a01464433d6").dynamicListItems;for(var p in l)i=l[p],c(e.context.pageData,"services").indexOf(c(i,"services"))+1!=0&&(i.servch=!0);e.context.pageData.datetimedata=new Date(d(c(e.context.pageData,"appttime"),18)),e.context.pageData.addval=d(c(e.context.pageData,"apptaddress"),21),o=(await Backendless.Data.of("appt").find(Backendless.DataQueryBuilder.create().setWhereClause(["objectId = '",c(e.context.pageData,"objectId"),"'"].join("")).setProperties(["last","card"]).setPageSize(100)))[0],r=(await Backendless.Data.of("defcard").find(Backendless.DataQueryBuilder.create().setWhereClause(["email = '",c(await Backendless.UserService.getCurrentUser(!1),"email"),"'"].join("")).setProperties(["objectId","last","email","card"]).setPageSize(10)))[0],s=c(o,"last"),t=c(r,"last"),n=c(o,"card"),a=c(r,"card"),e.context.pageData.deflabel1=["Choose your card ending ",s," (your saved payment method for this appointment), or"].join(""),e.context.pageData.deflabel2=["Choose your card ending ",t," (your default payment method), or"].join(""),e.context.pageData.rbgchk="radio1",e.context.pageData.dislateruse=!0,e.context.pageData.defvis2=n!=a&&"xxxx"!=t},async onEnter(e){function t(e,t){if("string"!=typeof t||void 0!==e[t])return e[t];const a=t.split(".");let n=e;for(let e=0;e<a.length;e++){if(!n||void 0===n[a[e]])return;n=n[a[e]]}return n}await async function(e){window.paymentElement=null,window.stripeInstance=null,window.csec=e;var t=document.createElement("script");t.src="https://js.stripe.com/v3/",document.head.appendChild(t),t.onload=function(){if(console.log("Stripe script loaded successfully!"),!window.csec)return void console.error("Client secret (csec) is not defined.");const e=Stripe("pk_live_51Rw4P6AwQAw6rEIQP8KPUFIQdjDgyEcFRcw096HLYxJcMlIdPMGyufwmemOmiNerVELKmrapYh5fH4kb1C71qlQu001VjPOpXp");window.stripeInstance=e;const t={clientSecret:window.csec,appearance:{theme:"flat"}},a=e.elements(t),n=document.evaluate("//form/div",document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(n){const e={disableLink:!0,hidePostalCode:!0};window.paymentElement=a.create("card",e),window.paymentElement.mount(n),console.log("Payment element mounted successfully.")}else console.error("Failed to locate the form element using XPath.")}}(t((await Backendless.Data.of("appt").find(Backendless.DataQueryBuilder.create().setWhereClause(["objectId = '",t(e.context.pageData,"objectId"),"'"].join("")).setProperties("client_secret").setPageSize(100)))[0],"client_secret"))}}))),define("./pages/pageprovideredit/components/62bed3fdedbf96d3c00816f3f06c740e/bundle.js",[],(()=>({onClick(e){window.history.back()}}))),define("./pages/pageprovideredit/components/9398bedc5bafe978abe3c6943db89d39/bundle.js",[],(()=>({async onClick(e){var t,a,n,s,r,o,i,c,d,l,p,u,g,f,m,v,k,y,w,B,h,b;function D(e,t){if("string"!=typeof t||void 0!==e[t])return e[t];const a=t.split(".");let n=e;for(let e=0;e<a.length;e++){if(!n||void 0===n[a[e]])return;n=n[a[e]]}return n}function C(e){return Array.isArray(e)?e:[e]}try{e.context.pageData.disbuttonforappt=!0,p=null,u=null,c=null,o=null,a=null,l=D((await Backendless.Data.of("signupdata").find(Backendless.DataQueryBuilder.create().setWhereClause(["email = '",D(await Backendless.UserService.getCurrentUser(!1),"email"),"'"].join("")).setProperties("stripecustid").setPageSize(100)))[0],"stripecustid"),s=(t=await Backendless.Data.of("appt").find(Backendless.DataQueryBuilder.create().setWhereClause(["objectId = '",D(e.context.pageData,"objectId"),"'"].join("")).setProperties(["objectId","address","amount","card","client_secret","intent_id","last","custemail","prvemail","services","status","time","totalcost"]).setPageSize(10)))[0],i=await Backendless.Data.of("defcard").find(Backendless.DataQueryBuilder.create().setWhereClause(["email = '",D(await Backendless.UserService.getCurrentUser(!1),"email"),"'"].join("")).setProperties(["objectId","last","email","card"]).setPageSize(10)),m="",r=0;var x=e.context.getComponentByUid("c46b23da0c13145db7313a01464433d6").dynamicListItems;for(var P in x)1==D(B=x[P],"servch")&&(console.log(B),r+=D(B,"price"),m=[m,D(B,"services")," for ",D(B,"price"),". "].join(""));if("radio1"==D(e.context.pageData,"rbgchk"))k=D(s,"card"),v=D(s,"last");else if("radio2"==D(e.context.pageData,"rbgchk"))w=i[0],k=D(w,"card"),v=D(w,"last");else{if(y=await async function(){return new Promise(((e,t)=>{if(window.stripeInstance&&window.paymentElement){const a=window.stripeInstance,n=window.paymentElement;a.createToken(n).then((function(a){a.error?(console.error("Error creating token:",a.error.message),t(a.error)):a.token?(console.log("Token created successfully:",a.token),e(a.token)):(console.warn("Unexpected result from createToken:",a),t(new Error("Unexpected result from createToken")))}))}else console.error("Stripe or paymentElement is not initialized."),t(new Error("Stripe or paymentElement is not initialized."))}))}(),p=await Backendless.Request.post(`${Backendless.appPath}/services/PaymentService/createCard`).set("Content-Type","application/json").set((b={"user-token":Backendless.getCurrentUserToken()},b["user-token"]||delete b["user-token"],b)).send({cust:l,src:D(y,"id")}),D(p,"customer")!=l)throw new Error("create card object did not return the customer id provided");if(k=D(p,"id"),v=D(p,"last4"),1==D(e.context.pageData,"cardch")){if(d=await Backendless.Request.get(`${Backendless.appPath}/services/PaymentService/Customer`).set(function(e){return e["user-token"]||delete e["user-token"],e}({"user-token":Backendless.getCurrentUserToken()})).query({cust_id:JSON.stringify(l)}).send(),u=await Backendless.Request.post(`${Backendless.appPath}/services/PaymentService/updateCust`).set("Content-Type","application/json").set(function(e){return e["user-token"]||delete e["user-token"],e}({"user-token":Backendless.getCurrentUserToken()})).send({cust:l,defsrc:D(p,"id")}),D(u,"default_source")!=D(p,"id"))throw new Error("default source of updated customer object does not match the provided card id");if(c=await Backendless.Data.of("defcard").save((await Promise.all(i.map((async e=>({objectId:D(e,"objectId"),last:D(p,"last4"),email:D(e,"email"),card:D(p,"id")})))))[0]),D(c,"card")!=D(p,"id"))throw new Error("card updated in def card table does not match the provided card id")}}if(0==r)throw new Error("Please select atleast one service to book the appointment");if(n=await Backendless.Request.get(`${Backendless.appPath}/services/PaymentService/Payment`).set(function(e){return e["user-token"]||delete e["user-token"],e}({"user-token":Backendless.getCurrentUserToken()})).query({intent_id:JSON.stringify(D(s,"intent_id"))}).send(),o=await Backendless.Request.post(`${Backendless.appPath}/services/PaymentService/updatePayment`).set("Content-Type","application/json").set(function(e){return e["user-token"]||delete e["user-token"],e}({"user-token":Backendless.getCurrentUserToken()})).send({intent_id:D(s,"intent_id"),amount:110*r,meth:k,cust:l}),D(o,"amount")!=110*r)throw new Error("amount in updated payment intent does not match the provided amount");if(a=await Backendless.Data.of("appt").save((await Promise.all(t.map((async t=>({objectId:D(t,"objectId"),address:D(e.context.pageData,"addval"),amount:110*r,card:k,client_secret:D(t,"client_secret"),intent_id:D(t,"intent_id"),last:v,custemail:D(t,"custemail"),prvemail:D(t,"prvemail"),services:m,status:"requested",time:D(e.context.pageData,"datetimedata"),totalcost:r})))))[0]),D(a,"amount")!=110*r)throw new Error("amount in updated appt record does not match the provided amount");f=await Backendless.Data.of("srvcity").find(Backendless.DataQueryBuilder.create().setWhereClause(["email = '",D(s,"prvemail"),"'"].join("")).setProperties(["stripeaccountid","avgrating","totalratings","cityserviced","email","name","pic","professions","services","objectId"]).setPageSize(100)),1==D(e.context.pageData,"cardch")&&await Backendless.Messaging.sendEmail("Payment method edited",new Backendless.Bodyparts({textmessage:["Hello ",D(await Backendless.UserService.getCurrentUser(!1),"name"),"\n","You have successfully added/changed your default payment card.","\n","Regards, Rongta"].join("")}),C(D(await Backendless.UserService.getCurrentUser(!1),"email")),void 0),await Backendless.Messaging.sendEmail("Appointment request edited",new Backendless.Bodyparts({textmessage:["Hello ",D(await Backendless.UserService.getCurrentUser(!1),"name"),"\n","You have successfully edited your appointment request with ",D(f[0],"name"),"\n","Regards, Rongta"].join("")}),C(D(await Backendless.UserService.getCurrentUser(!1),"email")),void 0),await Backendless.Messaging.sendEmail("Appointment request edited",new Backendless.Bodyparts({textmessage:["Hello ",D(f[0],"name"),"\n",D(await Backendless.UserService.getCurrentUser(!1),"name")," has made edits to the appointment request with you.","\n","Regards, Rongta"].join("")}),C(D(f[0],"email")),void 0),h=void 0,BackendlessUI.Navigator.goToPage("appt",h)}catch(g){console.log(g),e.context.pageData.guierr=D(g,"message"),p&&D(p,"customer")==l&&await Backendless.Request.delete(`${Backendless.appPath}/services/PaymentService/Card`).set("Content-Type","application/json").set(function(e){return e["user-token"]||delete e["user-token"],e}({"user-token":Backendless.getCurrentUserToken()})).send({cust:l,card:D(p,"id")}),u&&D(u,"default_source")==D(p,"id")&&await Backendless.Request.post(`${Backendless.appPath}/services/PaymentService/updateCust`).set("Content-Type","application/json").set(function(e){return e["user-token"]||delete e["user-token"],e}({"user-token":Backendless.getCurrentUserToken()})).send({cust:l,defsrc:D(d,"default_source")}),c&&await Backendless.Data.of("defcard").save((await Promise.all([c].map((async e=>i[0]))))[0]),o&&D(o,"amount")==110*r&&await Backendless.Request.post(`${Backendless.appPath}/services/PaymentService/updatePayment`).set("Content-Type","application/json").set(function(e){return e["user-token"]||delete e["user-token"],e}({"user-token":Backendless.getCurrentUserToken()})).send({intent_id:D(s,"intent_id"),amount:D(n,"amount"),meth:D(n,"payment_method"),cust:D(n,"customer")}),a&&await Backendless.Data.of("appt").save((await Promise.all([a].map((async e=>t[0]))))[0]),e.context.pageData.disbuttonforappt=!1}}}))),define("./pages/pageprovideredit/components/57a97a6a4c291465fecbeed6a436d02c/bundle.js",[],(()=>({onChange(e){var t,a,n;function s(e,t){if("string"!=typeof t||void 0!==e[t])return e[t];const a=t.split(".");let n=e;for(let e=0;e<a.length;e++){if(!n||void 0===n[a[e]])return;n=n[a[e]]}return n}try{e.context.getComponentDataStoreByUid("a3e69f69306e9eea26174fb541a96b83").discheck=!0,a=0;var r=e.context.getComponentByUid("c46b23da0c13145db7313a01464433d6").dynamicListItems;for(var o in r)1==s(n=r[o],"servch")&&(a+=s(n,"price"));e.context.pageData.showtotal=["Your total (incl. 10% platform fee) is: ",1.1*a," (You will only be charged if/when service provider accepts the appointment)"].join(""),e.context.pageData.visbutton=0!=a,e.context.getComponentDataStoreByUid("a3e69f69306e9eea26174fb541a96b83").discheck=!1}catch(t){console.log(t),e.context.getComponentDataStoreByUid("a3e69f69306e9eea26174fb541a96b83").discheck=!1}}}))),define("./pages/pageprovideredit/components/52ab1cf752a82cc70da40b08bc961698/bundle.js",[],(()=>({onChange(e){e.context.pageData.cardch=!1,"radio3"==function(e,t){if("string"!=typeof t||void 0!==e[t])return e[t];const a=t.split(".");let n=e;for(let e=0;e<a.length;e++){if(!n||void 0===n[a[e]])return;n=n[a[e]]}return n}(e.context.pageData,"rbgchk")?e.context.pageData.dislateruse=!1:e.context.pageData.dislateruse=!0}}))),define("./pages/profile/components/0d635a3d7c3962977c03ab11c0ff99e2/bundle.js",[],(()=>({onContentAssignment:async e=>String("Welcome ")+String(function(e,t){if("string"!=typeof t||void 0!==e[t])return e[t];const a=t.split(".");let n=e;for(let e=0;e<a.length;e++){if(!n||void 0===n[a[e]])return;n=n[a[e]]}return n}(await Backendless.UserService.getCurrentUser(!1),"name"))}))),define("./pages/profile/components/cae3b4ffc1bf5599baa8cad69a3f914f/bundle.js",[],(()=>({async onClick(e){var t;await Backendless.UserService.logout(),t=void 0,BackendlessUI.Navigator.goToPage("landing",t)}}))),define("./pages/profile/components/c5b8038119d39463d0575485324f6bbf/bundle.js",[],(()=>({onClick(e){var t;t=void 0,BackendlessUI.Navigator.goToPage("defpayupdate",t)}}))),define("./pages/profile/components/233f0e793e1a410ea2c4052aeb1c0968/bundle.js",[],(()=>({onClick(e){var t;t=void 0,BackendlessUI.Navigator.goToPage("menu",t)}}))),define("./pages/profile/components/6a4bd36b61c8686d39ab25f66058079e/bundle.js",[],(()=>({onClick(e){var t;t=void 0,BackendlessUI.Navigator.goToPage("appt",t)}}))),define("./pages/profile/components/29d55baa17c680381b2cde94b42cc1b7/bundle.js",[],(()=>({onClick(e){var t;t=void 0,BackendlessUI.Navigator.goToPage("changepwd",t)}}))),define("./pages/profile/components/1b2c5b059525e01751d2cacb2e52eb7c/bundle.js",[],(()=>({onClick(e){var t;t=void 0,BackendlessUI.Navigator.goToPage("faqs",t)}}))),define("./pages/profile/components/f4fe200ff5e689e55f65cdb635b294aa/bundle.js",[],(()=>({onClick(e){var t;t=void 0,BackendlessUI.Navigator.goToPage("delreq",t)}}))),define("./pages/ratefulfil/components/3c13b5f8a5c55d5b6a4c142f86dbe2d6/bundle.js",[],(()=>({onClick(e){var t;t=void 0,BackendlessUI.Navigator.goToPage("profile",t)}}))),define("./pages/ratefulfil/components/page/bundle.js",[],(()=>({async onBeforeEnter(e){function t(e,t){if("string"!=typeof t||void 0!==e[t])return e[t];const a=t.split(".");let n=e;for(let e=0;e<a.length;e++){if(!n||void 0===n[a[e]])return;n=n[a[e]]}return n}console.log(e.context.pageData),e.context.pageData.headcontent=["Rate/Review Appointment with ",t((await Backendless.Data.of("prvsignupdata").find(Backendless.DataQueryBuilder.create().setWhereClause(["email = '",t(e.context.pageData,"chatprvemail"),"'"].join("")).setProperties("Name").setPageSize(100)))[0],"Name")," in ",t((await Backendless.Data.of("srvcity").find(Backendless.DataQueryBuilder.create().setWhereClause(["email = '",t(e.context.pageData,"chatprvemail"),"'"].join("")).setProperties("cityserviced").setPageSize(100)))[0],"cityserviced")].join(""),e.context.pageData.picurl=t((await Backendless.Data.of("srvcity").find(Backendless.DataQueryBuilder.create().setWhereClause(["email = '",t(e.context.pageData,"chatprvemail"),"'"].join("")).setProperties("pic").setPageSize(100)))[0],"pic")}}))),define("./pages/ratefulfil/components/62bed3fdedbf96d3c00816f3f06c740e/bundle.js",[],(()=>({onClick(e){window.history.back()}}))),define("./pages/ratefulfil/components/9398bedc5bafe978abe3c6943db89d39/bundle.js",[],(()=>({async onClick(e){var t,a,n,s,r,o,i,c,d,l,p;function u(e,t){if("string"!=typeof t||void 0!==e[t])return e[t];const a=t.split(".");let n=e;for(let e=0;e<a.length;e++){if(!n||void 0===n[a[e]])return;n=n[a[e]]}return n}function g(e){return Array.isArray(e)?e:[e]}try{if(e.context.pageData.disbutt=!0,s=null,n=null,c=null,a=await Backendless.Data.of("appt").find(Backendless.DataQueryBuilder.create().setWhereClause(["objectId = '",u(e.context.pageData,"objectId"),"'"].join("")).setProperties(["latest_charge","prvemail","services","totalcost","status","time","objectId","custemail"]).setPageSize(100)),i=await Backendless.Data.of("srvcity").find(Backendless.DataQueryBuilder.create().setWhereClause(["email = '",u(e.context.pageData,"chatprvemail"),"'"].join("")).setProperties(["stripeaccountid","avgrating","totalratings","cityserviced","email","name","pic","professions","services","objectId"]).setPageSize(100)),s=await Backendless.Request.post(`${Backendless.appPath}/services/PaymentService/createTransfer`).set("Content-Type","application/json").set((p={"user-token":Backendless.getCurrentUserToken()},p["user-token"]||delete p["user-token"],p)).send({amount:100*u(a[0],"totalcost"),currency:"cad",srct:u(a[0],"latest_charge"),dest:u(i[0],"stripeaccountid")}),u(s,"source_transaction")!=u(a[0],"latest_charge"))throw new Error("create transfer record did not return with the provided source transaction");if(n=await Backendless.Data.of("appt").save((await Promise.all(a.map((async t=>({latest_charge:u(t,"latest_charge"),objectId:u(t,"objectId"),custemail:u(t,"custemail"),prvemail:u(t,"prvemail"),services:u(t,"services"),status:"fulfiled",time:u(t,"time"),totalcost:u(t,"totalcost"),rating:Number(u(e.context.pageData,"rating")),review:u(e.context.pageData,"reviewtext")})))))[0]),"fulfiled"!=u(n,"status"))throw new Error("appointment record could not be updated to fulfiled");if((t=await Backendless.Data.of("appt").find(Backendless.DataQueryBuilder.create().setWhereClause(["prvemail = '",u(e.context.pageData,"chatprvemail"),"' AND rating != NULL"].join("")).setProperties("rating").setPageSize(100))).length>=1?(l=t.map((e=>e.rating)),o=l.reduce((function(e,t){return e+t}))/l.length):o=0,c=await Backendless.Data.of("srvcity").save((await Promise.all(i.map((async t=>({stripeaccountid:u(t,"stripeaccountid"),objectId:u(t,"objectId"),professions:u(t,"professions"),pic:u(t,"pic"),services:u(t,"services"),name:u(t,"name"),email:u(t,"email"),cityserviced:u(t,"cityserviced"),avgrating:o,totalratings:(await Backendless.Data.of("appt").find(Backendless.DataQueryBuilder.create().setWhereClause(["prvemail = '",u(e.context.pageData,"chatprvemail"),"' AND rating != NULL"].join("")).setProperties("rating").setPageSize(100))).length})))))[0]),u(c,"avgrating")!=o)throw new Error("srvcity record could not be updated to new avg rating");await Backendless.Messaging.sendEmail("Appointment fulfiled",new Backendless.Bodyparts({textmessage:["Hello ",u(await Backendless.UserService.getCurrentUser(!1),"name"),"\n","You have fulfiled your appointment with ",u(i[0],"name"),"\n","Regards, Rongta"].join("")}),g(u(await Backendless.UserService.getCurrentUser(!1),"email")),void 0),await Backendless.Messaging.sendEmail("Appointment fulfiled - Payout dispatched",new Backendless.Bodyparts({textmessage:["Hello ",u(i[0],"name"),"\n",u(await Backendless.UserService.getCurrentUser(!1),"name")," has marked your appointment as fulfiled. We have dispatched a payment to your saved bank account for CAD ",u(a[0],"totalcost"),"\n","Regards, Rongta"].join("")}),g(u(i[0],"email")),void 0),d=void 0,BackendlessUI.Navigator.goToPage("appt",d)}catch(r){console.log(r),e.context.pageData.guierr=u(r,"message"),s&&u(s,"source_transaction")==u(a[0],"latest_charge")&&await Backendless.Request.post(`${Backendless.appPath}/services/PaymentService/reverseTransfer`).set("Content-Type","application/json").set(function(e){return e["user-token"]||delete e["user-token"],e}({"user-token":Backendless.getCurrentUserToken()})).send(JSON.stringify(u(s,"id"))),n&&await Backendless.Data.of("appt").save((await Promise.all([n].map((async e=>a[0]))))[0]),c&&await Backendless.Data.of("srvcity").save((await Promise.all([c].map((async e=>i[0]))))[0]),e.context.pageData.disbutt=!1}}}))),define("./pages/signin/components/a881154a9339f144b6295e49b33fe9af/bundle.js",[],(()=>({async onClick(e){var t,a,n;function s(e,t){if("string"!=typeof t||void 0!==e[t])return e[t];const a=t.split(".");let n=e;for(let e=0;e<a.length;e++){if(!n||void 0===n[a[e]])return;n=n[a[e]]}return n}try{if(e.context.pageData.disbutt=!0,t=null,"customer"==s((await Backendless.Data.of("Users").find(Backendless.DataQueryBuilder.create().setWhereClause(["email = '",s(e.context.pageData,"Input-fc2e"),"'"].join("")).setProperties("type").setPageSize(10)))[0],"type")){if(t=await Backendless.UserService.login(s(e.context.pageData,"Input-fc2e"),s(e.context.pageData,"Input-010e"),!0),s(t,"email")!=s(e.context.pageData,"Input-fc2e"))throw new Error("returned login object user does not have the same email as the one enetered");n=void 0,BackendlessUI.Navigator.goToPage("menu",n)}e.context.pageData.disbutt=!1}catch(a){console.log(a),e.context.pageData.guierr=s(a,"message"),t&&await Backendless.UserService.logout(),e.context.pageData.disbutt=!1}}}))),define("./pages/signin/components/faf89fbadbba942a547ae43a18562c7b/bundle.js",[],(()=>({onClick(e){var t;t=void 0,BackendlessUI.Navigator.goToPage("signup",t)}}))),define("./pages/signin/components/5548cd4a1f1703496afc83afff62c135/bundle.js",[],(()=>({onClick(e){var t;t=void 0,BackendlessUI.Navigator.goToPage("fgtpwd",t)}}))),define("./pages/signup/components/a881154a9339f144b6295e49b33fe9af/bundle.js",[],(()=>({async onClick(e){var t,a,n,s,r,o,i,c,d,l;function p(e,t){if("string"!=typeof t||void 0!==e[t])return e[t];const a=t.split(".");let n=e;for(let e=0;e<a.length;e++){if(!n||void 0===n[a[e]])return;n=n[a[e]]}return n}try{if(e.context.pageData.disbutt=!0,o=null,s=null,n=null,a=null,t=null,o=await Backendless.Request.post(`${Backendless.appPath}/services/PaymentService/createCustomer`).set("Content-Type","application/json").set((l={"user-token":Backendless.getCurrentUserToken()},l["user-token"]||delete l["user-token"],l)).send(JSON.stringify(p(e.context.pageData,"Input-fc2e"))),p(o,"email")!=p(e.context.pageData,"Input-fc2e"))throw new Error("returned stripe customer doesn't have the same email that was provided");if(r=p(o,"id"),s=await Backendless.Data.of("signupdata").save({stripecustid:r,email:p(e.context.pageData,"Input-fc2e"),Name:p(e.context.pageData,"Input-65a9"),password:p(e.context.pageData,"Input-010e"),phonenum:Number(p(e.context.pageData,"Input-dc06")),postalcode:p(e.context.pageData,"Input-75fc")}),p(s,"email")!=p(e.context.pageData,"Input-fc2e"))throw new Error("returned signupdata object doesn't have the same email that was provided");if(n=await Backendless.Data.of("defcard").save({last:"xxxx",email:p(e.context.pageData,"Input-fc2e"),card:"nocard"}),p(n,"email")!=p(e.context.pageData,"Input-fc2e"))throw new Error("returned defcard object doesn't have the same email that was provided");if(a=await Backendless.UserService.register(new Backendless.User({email:p(e.context.pageData,"Input-fc2e"),password:p(e.context.pageData,"Input-010e"),name:p(e.context.pageData,"Input-65a9"),phonenum:Number(p(e.context.pageData,"Input-dc06")),postalcode:p(e.context.pageData,"Input-75fc"),type:"customer"})),p(a,"email")!=p(e.context.pageData,"Input-fc2e"))throw new Error("returned registereduser object doesn't have the same email that was provided");if(t=await Backendless.UserService.login(p(e.context.pageData,"Input-fc2e"),p(e.context.pageData,"Input-010e"),!0),p(t,"email")!=p(e.context.pageData,"Input-fc2e"))throw new Error("returned loginuser object doesn't have the same email that was provided");await Backendless.Messaging.sendEmail("Welcome to Rongta",new Backendless.Bodyparts({textmessage:["Hello ",p(e.context.pageData,"Input-65a9"),"\n","You have successfully created your client account.","\n","Regards, Rongta"].join("")}),(d=p(e.context.pageData,"Input-fc2e"),Array.isArray(d)?d:[d]),void 0),c=void 0,BackendlessUI.Navigator.goToPage("menu",c)}catch(i){console.log(i),e.context.pageData.guierr=p(i,"message"),o&&p(o,"email")==p(e.context.pageData,"Input-fc2e")&&await Backendless.Request.delete(`${Backendless.appPath}/services/PaymentService/Customer`).set("Content-Type","application/json").set(function(e){return e["user-token"]||delete e["user-token"],e}({"user-token":Backendless.getCurrentUserToken()})).send(JSON.stringify(r)),s&&await Backendless.Data.of("signupdata").remove(p(s,"objectId")),n&&await Backendless.Data.of("defcard").remove(p(n,"objectId")),a&&await Backendless.Data.of(Backendless.User).remove({objectId:p(a,"objectId")}),t&&await Backendless.UserService.logout(),e.context.pageData.disbutt=!1}}}))),define("./pages/signup/components/aa94900d943e4e96a8faab3857262564/bundle.js",[],(()=>({onClick(e){var t;t=void 0,BackendlessUI.Navigator.goToPage("signin",t)}})));
//# sourceMappingURL=./main.js.map